{% extends 'base.html' %}
{% block content %}
<div class="page-header">
    <div>
        <a href="/manager/clients" class="back-link">← Назад к списку</a>
        <h2>Клиент</h2>
    </div>
</div>

<div class="detail-grid">
    <!-- Основная информация -->
    <div class="card">
        <h3>Информация о клиенте</h3>
        <table class="info-table">
            <tr>
                <td>Email:</td>
                <td><strong>{{ client.email or '-' }}</strong></td>
            </tr>
            <tr>
                <td>Телефон:</td>
                <td>{{ client.phone or '-' }}</td>
            </tr>
            <tr>
                <td>Всего ключей:</td>
                <td>{{ client.keys_count }}</td>
            </tr>
            <tr>
                <td>Потрачено:</td>
                <td><strong>{{ client.total_spent }}₽</strong></td>
            </tr>
            <tr>
                <td>Первый ключ:</td>
                <td>{{ client.first_key[:10] if client.first_key else '-' }}</td>
            </tr>
            <tr>
                <td>Последний ключ:</td>
                <td>{{ client.last_key[:10] if client.last_key else '-' }}</td>
            </tr>
        </table>
    </div>
</div>

<!-- История ключей -->
<div class="card">
    <h3>История ключей</h3>
    {% if keys %}
    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Дата</th>
                <th>Период</th>
                <th>Дней</th>
                <th>Цена</th>
                <th>Менеджер</th>
                <th>Client ID</th>
            </tr>
        </thead>
        <tbody>
            {% for k in keys %}
            <tr>
                <td>{{ k.id }}</td>
                <td>{{ k.created_at[:16] if k.created_at else '-' }}</td>
                <td>{{ k.period or '-' }}</td>
                <td>{{ k.expire_days or '-' }}</td>
                <td>{% if k.price %}{{ k.price }}₽{% else %}-{% endif %}</td>
                <td>{{ k.manager_name or '-' }}</td>
                <td><code>{{ k.client_id[:20] if k.client_id else '-' }}...</code></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted">Нет истории</p>
    {% endif %}
</div>

<style>
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 20px;
}
.back-link {
    color: #888;
    text-decoration: none;
    font-size: 0.9em;
}
.back-link:hover {
    color: #fff;
}
.detail-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}
.card {
    background: #1e1e1e;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}
.card h3 {
    margin: 0 0 15px 0;
    color: #fff;
    font-size: 1.1em;
}
.info-table {
    width: 100%;
}
.info-table td {
    padding: 8px 0;
    border-bottom: 1px solid #333;
}
.info-table td:first-child {
    color: #888;
    width: 150px;
}
.table {
    width: 100%;
    border-collapse: collapse;
}
.table th, .table td {
    padding: 10px;
    text-align: left;
    border-bottom: 1px solid #333;
}
.table th {
    background: #2a2a2a;
    font-weight: 600;
    font-size: 0.9em;
}
code {
    background: #2a2a2a;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 0.85em;
}
.text-muted {
    color: #666;
}
</style>
{% endblock %}
