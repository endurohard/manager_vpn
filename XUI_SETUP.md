# Настройка X-UI панели для работы с ботом

## Проверка работы X-UI

### 1. Проверьте, запущена ли X-UI панель

```bash
# Проверка статуса
systemctl status x-ui

# Если не запущена, запустите
systemctl start x-ui

# Добавьте в автозагрузку
systemctl enable x-ui
```

### 2. Найдите порт X-UI панели

```bash
# Проверьте конфигурацию X-UI
cat /etc/x-ui/x-ui.db

# Или проверьте через команду
x-ui status
```

Обычно X-UI работает на портах:
- `54321` (по умолчанию)
- `2053`
- `2083`

### 3. Проверьте доступность панели

```bash
# Попробуйте открыть панель через curl
curl http://localhost:54321

# Или через другой порт
curl http://localhost:2053
```

Если панель доступна, вы увидите HTML код или JSON ответ.

## Настройка Inbound в X-UI

### 1. Откройте X-UI панель в браузере

Откройте в браузере:
- `http://YOUR_SERVER_IP:54321` (замените на ваш IP и порт)

### 2. Войдите в панель

Используйте логин и пароль, которые вы задали при установке X-UI.

### 3. Создайте или проверьте Inbound

1. Перейдите в раздел **Inbounds**
2. Найдите или создайте новый inbound с протоколом **VLESS**
3. Запомните **ID** этого inbound (обычно это число, например 12)

### 4. Настройте Inbound

Рекомендуемые настройки:

**Протокол:** VLESS
**Порт:** Любой свободный (например, 443, 8443, 2053)
**Network:** ws, tcp или grpc
**Security:** tls или reality (опционально)

**Settings (JSON):**
```json
{
  "clients": [],
  "decryption": "none",
  "fallbacks": []
}
```

**Stream Settings:** Настройте по вашим требованиям

## Настройка бота для подключения к X-UI

### 1. Узнайте параметры подключения

- **Host:** Если X-UI на этом же сервере: `http://localhost:ПОРТ`
- **Username:** Логин от панели X-UI
- **Password:** Пароль от панели X-UI
- **Inbound ID:** ID вашего VLESS inbound

### 2. Отредактируйте .env файл

```bash
nano /root/manager_vpn/.env
```

Заполните правильные данные:

```env
# X-UI Panel Configuration
XUI_HOST=http://localhost:54321
XUI_USERNAME=admin
XUI_PASSWORD=admin

# Inbound ID
INBOUND_ID=12
```

### 3. Перезапустите бота

```bash
pkill -f "python3 main.py"
source venv/bin/activate
python3 main.py > bot_output.log 2>&1 &
```

### 4. Проверьте подключение

```bash
tail -f bot_output.log
```

Вы должны увидеть:
```
INFO - Успешное подключение к X-UI панели
```

## Устранение проблем

### Ошибка: "Cannot connect to host localhost:54321"

**Решение:**
1. Проверьте, запущена ли X-UI: `systemctl status x-ui`
2. Проверьте порт: `netstat -tlnp | grep x-ui`
3. Попробуйте другой порт в .env файле

### Ошибка: "Login error" или "403 Forbidden"

**Решение:**
1. Проверьте логин и пароль в .env файле
2. Попробуйте войти в панель через браузер с этими данными
3. Если данные неверны, измените их в X-UI панели

### Ошибка при создании ключа: "Inbound not found"

**Решение:**
1. Откройте X-UI панель
2. Проверьте ID вашего inbound (находится в списке inbounds)
3. Обновите `INBOUND_ID` в .env файле
4. Перезапустите бота

## Дополнительная настройка

### Настройка домена

Если вы используете домен для VPN:

1. Настройте DNS запись для вашего домена
2. Укажите домен в .env файле:
   ```env
   DOMAIN=raphaeilvpn.ru
   ```
3. В X-UI панели настройте TLS сертификат для вашего домена

### Безопасность

Рекомендации:
1. Используйте сильный пароль для X-UI панели
2. Измените порт X-UI с 54321 на другой
3. Настройте firewall для ограничения доступа к панели
4. Используйте TLS/SSL для шифрования

```bash
# Пример настройки firewall
ufw allow 443/tcp   # Порт для VPN
ufw allow 2053/tcp  # Порт X-UI панели (измените на свой)
```
